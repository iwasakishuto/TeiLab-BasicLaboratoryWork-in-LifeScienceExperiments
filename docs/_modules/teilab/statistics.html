

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>teilab.statistics &mdash; UiTei-Lab&#39;s Course Documentation  documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/plot_directive.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/togglebutton.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/popup.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/togglebutton.js"></script>
        <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
        <script src="../../_static/custom.js"></script>
        <script src="../../_static/particles.min.js"></script>
        <script src="../../_static/popup.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> UiTei-Lab's Course Documentation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
<ul class="utility-btns">
  <li>
    <a class="btn btn-icon btn-start" href="#" onclick="changeParticles(this);"
      >Start Particles</a
    >
  </li>
  <li>
    <a class="btn btn-icon btn-expand" href="#" onclick="changeStyle(this);"
      >Expand</a
    >
  </li>
</ul>
<div class="sidebarlogo">
  <h4>Lab's information</h4>
  <ul class="social">
    
    <li>
      <a class="sc-book" href="http://ui-tei.rnai.jp/" target="_blank">
        <i class="fa fa-book" aria-hidden="true"></i>
      </a>
    </li>
    
    <li>
      <a class="sc-wikipedia-w" href="http://ui-tei.rnai.jp/microarray/doku.php?id=%E7%A8%8B%E7%A0%94%E5%AE%9F%E7%BF%92:2022" target="_blank">
        <i class="fa fa-wikipedia-w" aria-hidden="true"></i>
      </a>
    </li>
    
    <li>
      <a class="sc-file-pdf-o" href="https://doi.org/10.1021/acsomega.7b00291/" target="_blank">
        <i class="fa fa-file-pdf-o" aria-hidden="true"></i>
      </a>
    </li>
    
    <li>
      <a class="sc-slideshare" href="https://iwasakishuto.github.io/TeiLab-BasicLaboratoryWork-in-LifeScienceExperiments/slides/index.html" target="_blank">
        <i class="fa fa-slideshare" aria-hidden="true"></i>
      </a>
    </li>
    
    <li>
      <a class="sc-youtube-play" href="https://infty.tokyo/video/jCVSIvwVQw" target="_blank">
        <i class="fa fa-youtube-play" aria-hidden="true"></i>
      </a>
    </li>
    
  </ul>
  <h4>Author's Social link</h4>
  <ul class="social">
    
    <li>
      <a class="sc-twitter" href="https://twitter.com/cabernet_rock" target="_blank">
        <i class="fa fa-twitter" aria-hidden="true"></i>
      </a>
    </li>
    
    <li>
      <a class="sc-github" href="https://github.com/iwasakishuto" target="_blank">
        <i class="fa fa-github" aria-hidden="true"></i>
      </a>
    </li>
    
  </ul>
</div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../teilab.html">teilab package</a></li>
</ul>

            
          
        </div>
         
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">UiTei-Lab's Course Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
<canvas class="particle-background"></canvas>

        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>teilab.statistics</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for teilab.statistics</h1><div class="highlight"><pre>
<span></span><span class="c1"># coding: utf-8</span>
<span class="sa">r</span><span class="sd">&quot;&quot;&quot;This submodule contains various functions and classes that are useful for statistical testing.</span>

<span class="sd">############</span>
<span class="sd">Instructions</span>
<span class="sd">############</span>

<span class="sd">******************************</span>
<span class="sd">Statistical hypothesis testing</span>
<span class="sd">******************************</span>

<span class="sd">**Statistical hypothesis testing** is required to determine if expression levels (``gProcessedSignal`` s) have changed between samples with siRNA and those without siRNA.</span>

<span class="sd">    A statistical hypothesis test is a method of statistical inference. An **alternative hypothesis** is proposed for the probability distribution of the data. The comparison of the two models is deemed statistically significant if, according to a threshold probability—the significance level ( :math:`\alpha` ) — the data would be unlikely to occur if the **null hypothesis** were true. The **pre-chosen** level of significance is the maximal allowed &quot;false positive rate&quot;. One wants to control the risk of incorrectly rejecting a true **null hypothesis**.</span>

<span class="sd">    The process of distinguishing between the **null hypothesis** and the **alternative hypothesis** is aided by considering two conceptual types of errors.</span>

<span class="sd">    1. The first type of error occurs when the **null hypothesis** is wrongly rejected. (type 1 error)</span>
<span class="sd">    2. The second type of error occurs when the **null hypothesis** is wrongly not rejected. (type 2 error)</span>

<span class="sd">    Hypothesis tests based on statistical significance are another way of expressing confidence intervals (more precisely, confidence sets). In other words, every hypothesis test based on significance can be obtained via a confidence interval, and every confidence interval can be obtained via a hypothesis test based on significance. [#ref1]_</span>

<span class="sd">    .. [#ref1] :fa:`home` `Mathematical Statistics and Data Analysis (3rd ed.) &lt;https://www.amazon.com/Mathematical-Statistics-Analysis-Available-Enhanced/dp/0534399428&gt;`_</span>

<span class="sd">    .. seealso::</span>
<span class="sd">        :fa:`wikipedia-w` `Statistical_hypothesis_testing &lt;https://en.wikipedia.org/wiki/Statistical_hypothesis_testing&gt;`_</span>

<span class="sd">Various alternative hypotheses can be handled by changing the value of A</span>

<span class="sd">In this submodules, you can test each **null (alternative) hypothesis** by changing the value of ``alternative``</span>

<span class="sd">+--------------+-----------------+------------------------------------------+---------------------------------------------------------------------------------+</span>
<span class="sd">| Terminology  | ``alternative`` | Alternative Hypothesis                   | Rejection Region                                                                |</span>
<span class="sd">+==============+=================+==========================================+=================================================================================+</span>
<span class="sd">| right-tailed | ``&quot;greater&quot;``   |:math:`H_a:\sigma^2_1   &gt;  \sigma^2_2`    | :math:`\mathbf{F}\geq F_{\alpha}`                                               |</span>
<span class="sd">+--------------+-----------------+------------------------------------------+---------------------------------------------------------------------------------+</span>
<span class="sd">| left-tailed  | ``&quot;less&quot;``      |:math:`H_a:\sigma^2_1   &lt;  \sigma^2_2`    | :math:`\mathbf{F}\leq F_{1−\alpha}`                                             |</span>
<span class="sd">+--------------+-----------------+------------------------------------------+---------------------------------------------------------------------------------+</span>
<span class="sd">| two-tailed   | ``&quot;two-sided&quot;`` |:math:`H_a:\sigma^2_1 \neq \sigma^2_2`    | :math:`\mathbf{F}\leq F_{1−\alpha∕2}` or :math:`\mathbf{F}\geq F_{\alpha∕2}`    |</span>
<span class="sd">+--------------+-----------------+------------------------------------------+---------------------------------------------------------------------------------+</span>

<span class="sd">Follow the chart below to select the test.</span>

<span class="sd">.. graphviz:: _graphviz/graphviz_ChoosingStatisticalTest.dot</span>
<span class="sd">      :class: popup-img</span>

<span class="sd">Distributions</span>
<span class="sd">=============</span>

<span class="sd">- :ref:`gamma-distribution &lt;target to gamma-distribution section&gt;`</span>
<span class="sd">- :ref:`f-distribution &lt;target to f-distribution section&gt;`</span>
<span class="sd">- :ref:`t-distribution &lt;target to t-distribution section&gt;`</span>

<span class="sd">.. _target to gamma-distribution section:</span>

<span class="sd">gamma-distribution</span>
<span class="sd">------------------</span>

<span class="sd">The gamma function is defined as</span>

<span class="sd">    .. math::</span>
<span class="sd">       \Gamma(z) = \int_0^\infty t^{z-1} e^{-t} dt</span>

<span class="sd">for :math:`\Re(z) &gt; 0` and is extended to the rest of the complex plane by analytic continuation.</span>

<span class="sd">The gamma function is often referred to as the generalized factorial since :math:`\Gamma(n + 1) = n!` for natural numbers :math:`n`. More generally it satisfies the recurrence relation :math:`\Gamma(z + 1) = z \cdot \Gamma(z)` for complex :math:`z`, which, combined with the fact that :math:`\Gamma(1) = 1`, implies the above identity for :math:`z = n`.</span>

<span class="sd">.. code-block:: python</span>

<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; from scipy.special import gamma</span>
<span class="sd">    &gt;&gt;&gt; from scipy.integrate import quad</span>
<span class="sd">    &gt;&gt;&gt; def gamma_pdf(x):</span>
<span class="sd">    ...     return quad(func=lambda x,z:np.power(x, z-1)*np.exp(-x), a=0, b=np.inf, args=(x))[0]</span>
<span class="sd">    &gt;&gt;&gt; x = np.linspace(1e-2, 5, 100)</span>
<span class="sd">    &gt;&gt;&gt; fig, ax = plt.subplots(figsize=(6, 4))</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(x, gamma(x), color=&quot;red&quot;, alpha=0.5, label=&quot;scipy&quot;)</span>
<span class="sd">    &gt;&gt;&gt; ax.plot(x, np.vectorize(gamma_pdf)(x), color=&quot;blue&quot;, alpha=0.5, label=&quot;myfunc&quot;)</span>
<span class="sd">    &gt;&gt;&gt; ax.set_title(fr&quot;$\Gamma$-distribution&quot;, fontsize=14)</span>
<span class="sd">    &gt;&gt;&gt; ax.legend()</span>
<span class="sd">    &gt;&gt;&gt; ax.set_ylim(0, 10)</span>
<span class="sd">    &gt;&gt;&gt; fig.savefig(&quot;statistics.distributions.gamma.jpg&quot;)</span>

<span class="sd">+-------------------------------------------------------+</span>
<span class="sd">|                      Results                          |</span>
<span class="sd">+=======================================================+</span>
<span class="sd">| .. image:: _images/statistics.distributions.gamma.jpg |</span>
<span class="sd">|    :class: popup-img                                  |</span>
<span class="sd">+-------------------------------------------------------+</span>

<span class="sd">.. _target to f-distribution section:</span>

<span class="sd">f-distribution</span>
<span class="sd">--------------</span>

<span class="sd">The probability density function for `f` is:</span>

<span class="sd">.. math::</span>
<span class="sd">    f(x, df_1, df_2) = \frac{df_2^{df_2/2} df_1^{df_1/2} x^{df_1 / 2-1}}{(df_2+df_1 x)^{(df_1+df_2)/2}B(df_1/2, df_2/2)}</span>

<span class="sd">for :math:`x &gt; 0`.</span>

<span class="sd">.. code-block:: python</span>

<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">        &gt;&gt;&gt; from scipy import stats</span>
<span class="sd">        &gt;&gt;&gt; from scipy.special import beta</span>
<span class="sd">        &gt;&gt;&gt; def f_pdf(x,dfn,dfd):</span>
<span class="sd">        ...     return (dfd**(dfd/2) * dfn**(dfn/2) * x**(dfn/2-1)) / ((dfd+dfn*x)**((dfn+dfd)/2) * beta(dfn/2, dfd/2))</span>
<span class="sd">        &gt;&gt;&gt; dfns = [2,5,12]; dfds = [2,9,12]</span>
<span class="sd">        &gt;&gt;&gt; x = np.linspace(0.001, 5, 1000)</span>
<span class="sd">        &gt;&gt;&gt; fig, axes = plt.subplots(nrows=len(dfns), ncols=len(dfds), sharex=True, sharey=&quot;row&quot;, figsize=(5*len(dfns), 5*len(dfds)))</span>
<span class="sd">        &gt;&gt;&gt; for axes_row, dfn in zip(axes, dfns):</span>
<span class="sd">        ...     for ax, dfd in zip(axes_row, dfds):</span>
<span class="sd">        ...         ax.plot(x, stats.f.pdf(x, dfn=dfn, dfd=dfd), color=&quot;red&quot;, alpha=0.5, label=&quot;scipy&quot;)</span>
<span class="sd">        ...         ax.plot(x, f_pdf(x, dfn=dfn,dfd=dfd), color=&quot;blue&quot;, alpha=0.5, label=&quot;myfunc&quot;)</span>
<span class="sd">        ...         ax.set_title(f&quot;f-distribution (dfn={dfn}, dfd={dfd})&quot;, fontsize=14)</span>
<span class="sd">        ...         ax.legend()</span>
<span class="sd">        &gt;&gt;&gt; fig.show()</span>

<span class="sd">+---------------------------------------------------+</span>
<span class="sd">|                      Results                      |</span>
<span class="sd">+===================================================+</span>
<span class="sd">| .. image:: _images/statistics.distributions.f.jpg |</span>
<span class="sd">|    :class: popup-img                              |</span>
<span class="sd">+---------------------------------------------------+</span>

<span class="sd">.. _target to t-distribution section:</span>

<span class="sd">t-distribution</span>
<span class="sd">--------------</span>

<span class="sd">The probability density function for `t` is:</span>

<span class="sd">.. math::</span>
<span class="sd">    f(x, \nu) = \frac{\Gamma((\nu+1)/2)}{\sqrt{\pi \nu} \Gamma(\nu/2)}(1+x^2/\nu)^{-(\nu+1)/2}</span>

<span class="sd">where :math:`x` is a real number and the degrees of freedom parameter :math:`\nu` satisfies :math:`\nu &gt; 0`.</span>

<span class="sd">.. code-block:: python</span>

<span class="sd">    &gt;&gt;&gt; import numpy as np</span>
<span class="sd">    &gt;&gt;&gt; import matplotlib.pyplot as plt</span>
<span class="sd">    &gt;&gt;&gt; from scipy import stats</span>
<span class="sd">    &gt;&gt;&gt; from scipy.special import gamma</span>
<span class="sd">    &gt;&gt;&gt; def t_pdf(x,df):</span>
<span class="sd">    ...     return gamma((df+1)/2) / (np.sqrt(np.pi*df)*gamma(df/2)) * (1+x**2/df)**(-(df+1)/2)</span>
<span class="sd">    &gt;&gt;&gt; x = np.linspace(-3, 3, 1000)</span>
<span class="sd">    &gt;&gt;&gt; dfs = [1,3,7,90]</span>
<span class="sd">    &gt;&gt;&gt; fig, axes = plt.subplots(nrows=1, ncols=len(dfs), sharey=&quot;row&quot;, figsize=(6*len(dfs), 4))</span>
<span class="sd">    &gt;&gt;&gt; for ax,df in zip(axes,dfs):</span>
<span class="sd">    ...     ax.plot(x, stats.t.pdf(x, df=df), color=&quot;red&quot;, alpha=0.5, label=&quot;scipy&quot;)</span>
<span class="sd">    ...     ax.plot(x, t_pdf(x, df=df), color=&quot;blue&quot;, alpha=0.5, label=&quot;myfunc&quot;)</span>
<span class="sd">    ...     ax.set_title(f&quot;t-distribution (df={df})&quot;, fontsize=14)</span>
<span class="sd">    ...     ax.legend()</span>
<span class="sd">    &gt;&gt;&gt; fig.show()</span>

<span class="sd">+---------------------------------------------------+</span>
<span class="sd">|                      Results                      |</span>
<span class="sd">+===================================================+</span>
<span class="sd">| .. image:: _images/statistics.distributions.t.jpg |</span>
<span class="sd">|    :class: popup-img                              |</span>
<span class="sd">+---------------------------------------------------+</span>

<span class="sd">Notation</span>
<span class="sd">========</span>

<span class="sd">sample means</span>
<span class="sd">------------</span>

<span class="sd">Let</span>

<span class="sd">.. math::</span>
<span class="sd">    \overline{X}=\frac{1}{n_X}\sum_{i=1}^{n_X}X_{i}</span>

<span class="sd">be the sample means.</span>

<span class="sd">sample variances</span>
<span class="sd">----------------</span>

<span class="sd">Let</span>

<span class="sd">.. math::</span>
<span class="sd">    S_X^2&amp;={\frac{1}{n_X-1}}\sum_{i=1}^{n_X}\left(X_{i}-{\overline{X}}\right)^{2}\\&amp;={\frac{1}{n_X-1}}\left(\sum_{i=1}^{n_X}X_i^2-n_X\overline{X}^2\right)</span>

<span class="sd">be the sample variances.</span>

<span class="sd">##############</span>
<span class="sd">Python Objects</span>
<span class="sd">##############</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Number</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">matplotlib.axes</span> <span class="kn">import</span> <span class="n">Axes</span>
<span class="kn">from</span> <span class="nn">nptyping</span> <span class="kn">import</span> <span class="n">NDArray</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>

<span class="kn">from</span> <span class="nn">.plot.matplotlib</span> <span class="kn">import</span> <span class="n">update_layout</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">_wilcoxon_data</span>
<span class="kn">from</span> <span class="nn">.utils._warnings</span> <span class="kn">import</span> <span class="n">InsufficientUnderstandingWarning</span><span class="p">,</span> <span class="n">TeiLabImprementationWarning</span><span class="p">,</span> <span class="n">_pack_warning_args</span>
<span class="kn">from</span> <span class="nn">.utils.generic_utils</span> <span class="kn">import</span> <span class="n">check_supported</span><span class="p">,</span> <span class="n">dict2str</span>
<span class="kn">from</span> <span class="nn">.utils.math_utils</span> <span class="kn">import</span> <span class="n">assign_rank</span><span class="p">,</span> <span class="n">tiecorrect</span>
<span class="kn">from</span> <span class="nn">.utils.plot_utils</span> <span class="kn">import</span> <span class="n">subplots_create</span>

<span class="n">SUPPORTED_ALTERNATIVES</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;two-sided&quot;</span><span class="p">,</span> <span class="s2">&quot;less&quot;</span><span class="p">,</span> <span class="s2">&quot;greater&quot;</span><span class="p">]</span>


<div class="viewcode-block" id="TestResult"><a class="viewcode-back" href="../../teilab.statistics.html#teilab.statistics.TestResult">[docs]</a><span class="k">class</span> <span class="nc">TestResult</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Structure that holds test results.</span>

<span class="sd">    Args:</span>
<span class="sd">        statistic (float)            : Test-specific statistical value.</span>
<span class="sd">        pvalue (float)               : The probability that an observed difference could have occurred just by random chance.</span>
<span class="sd">        alpha (float)                : The probability of making the wrong decision when the null hypothesis is true.</span>
<span class="sd">        alternative (str)            : Defines the alternative hypothesis. Please choose from [ ``&quot;two-sided&quot;``, ``&quot;less&quot;``, ``&quot;greater&quot;`` ]</span>
<span class="sd">        accepts (Tuple[float,float]) : Regions that accepts the null hypothesis.</span>
<span class="sd">        distribution (callable)      : Distribution used during the test.</span>
<span class="sd">        distname (str, optional)     : The distribution name. Defaults to ``&quot;&quot;``.</span>
<span class="sd">        testname (str, optional)     : The test name. Defaults to ``&quot;&quot;``.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        does_H0_hold (bool) : Does the null hypothesis hold?</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">statistic</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">pvalue</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
        <span class="n">alternative</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">accepts</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
        <span class="n">distribution</span><span class="p">:</span> <span class="n">callable</span><span class="p">,</span>
        <span class="n">distname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">testname</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">statistic</span> <span class="o">=</span> <span class="n">statistic</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pvalue</span> <span class="o">=</span> <span class="n">pvalue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="n">alpha</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alternative</span> <span class="o">=</span> <span class="n">alternative</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">accepts</span> <span class="o">=</span> <span class="n">accepts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">does_H0_hold</span> <span class="o">=</span> <span class="n">accepts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">statistic</span> <span class="o">&lt;</span> <span class="n">accepts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span> <span class="o">=</span> <span class="n">distribution</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distname</span> <span class="o">=</span> <span class="n">distname</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">testname</span> <span class="o">=</span> <span class="n">testname</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">testname</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">_Result(statistic=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">statistic</span><span class="si">}</span><span class="s2">, pvalue=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">pvalue</span><span class="si">}</span><span class="s2">)&quot;</span>

    <span class="k">def</span> <span class="fm">__iter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">statistic</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pvalue</span><span class="p">]:</span>
            <span class="k">yield</span> <span class="n">val</span>

<div class="viewcode-block" id="TestResult.plot"><a class="viewcode-back" href="../../teilab.statistics.html#teilab.statistics.TestResult.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span><span class="p">:</span>
        <span class="sd">&quot;&quot;&quot;Plot the test result.</span>

<span class="sd">        Args:</span>
<span class="sd">            x (Optional[NDArray[Any, Number]], optional) : X-axis Values. Defaults to ``None``.</span>
<span class="sd">            ax (Optional[Axes], optional)                : An instance of ``Axes``. Defaults to ``None``.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Axes: An instance of ``Axes`` with test result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span> <span class="ow">or</span> <span class="n">subplots_create</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;matplotlib&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">x</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
        <span class="n">y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="c1"># F-distribution</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">x</span><span class="p">,</span>
            <span class="n">y</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">distname</span><span class="si">}</span><span class="s2">-distribution (</span><span class="si">{</span><span class="n">dict2str</span><span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="p">,</span> <span class="s1">&#39;kwds&#39;</span><span class="p">,</span> <span class="p">{}))</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Visualize the Right and Left rejection areas</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">accepts</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Rejection Region (alpha=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha</span><span class="si">}</span><span class="s2">)&quot;</span>
        <span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y2</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">accepts</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">)</span>
        <span class="c1"># Indicates the position of calculated &quot;F&quot;</span>
        <span class="n">stats_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">statistic</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">statistic</span><span class="p">,</span>
            <span class="n">y</span><span class="o">=</span><span class="n">stats_y</span><span class="p">,</span>
            <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="sa">fr</span><span class="s2">&quot;$(x=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">distname</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span><span class="si">}</span><span class="s2">=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">statistic</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">,y=</span><span class="si">{</span><span class="n">stats_y</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)$&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="c1"># Update Layout.</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">update_layout</span><span class="p">(</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
            <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">testname</span><span class="si">}</span><span class="s2">-test (alternative: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alternative</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">Null-hypothesis </span><span class="si">{</span><span class="s1">&#39;holds&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">does_H0_hold</span> <span class="k">else</span> <span class="s1">&#39;rejects&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span>
            <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span>
            <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">ax</span></div></div>


<div class="viewcode-block" id="f_test"><a class="viewcode-back" href="../../teilab.statistics.html#teilab.statistics.f_test">[docs]</a><span class="k">def</span> <span class="nf">f_test</span><span class="p">(</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">],</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">],</span>
    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">alternative</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;two-sided&quot;</span><span class="p">,</span>
    <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TestResult</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;F-test for Equality of TWO Variances.</span>

<span class="sd">    If the two populations are normally distributed and if :math:`H_0:\sigma^2_1=\sigma^2_2` is true then under independent sampling :math:`F` approximately follows an F-distribution (:math:`f(x, df_1, df_2)`) with degrees of freedom :math:`df_1=n_1−1` and :math:`df_2=n_2−1`.</span>

<span class="sd">    .. admonition:: Statistic ( :math:`F` )</span>

<span class="sd">        .. container:: toggle, toggle-hidden</span>

<span class="sd">            .. math::</span>
<span class="sd">                F={\frac  {S_{A}^{2}}{S_{B}^{2}}}</span>

<span class="sd">    Args:</span>
<span class="sd">        a,b (NDArray[Any, Number])    : (Observed) Samples. The arrays must have the same shape.</span>
<span class="sd">        alpha (float)                 : The probability of making the wrong decision when the null hypothesis is true.</span>
<span class="sd">        alternative (str, optional)   : Defines the alternative hypothesis. Please choose from [ ``&quot;two-sided&quot;``, ``&quot;less&quot;``, ``&quot;greater&quot;`` ]. Defaults to ``&quot;two-sided&quot;``.</span>
<span class="sd">        plot (bool, optional)         : Whether to plot F-distribution or not. Defaults to ``False``.</span>
<span class="sd">        ax (Optional[Axes], optional) : An instance of ``Axes``. The distribution is drawn here when ``plot`` is ``True`` . Defaults to ``None``.</span>

<span class="sd">    Returns:</span>
<span class="sd">        TestResult: Structure that holds F-test results.</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: When ``alternative`` is not selected from [ ``&quot;two-sided&quot;``, ``&quot;less&quot;``, ``&quot;greater&quot;`` ].</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>
<span class="sd">        :class: popup-img</span>

<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from teilab.utils import subplots_create</span>
<span class="sd">        &gt;&gt;&gt; from teilab.statistics import f_test</span>
<span class="sd">        &gt;&gt;&gt; fig, axes = subplots_create(ncols=3, figsize=(18,4), style=&quot;matplotlib&quot;)</span>
<span class="sd">        &gt;&gt;&gt; A = np.array([6.3, 8.1, 9.4, 10.4, 8.6, 10.5, 10.2, 10.5, 10.0, 8.8])</span>
<span class="sd">        &gt;&gt;&gt; B = np.array([4.8, 2.1, 5.1,  2.0, 4.0,  1.0,  3.4,  2.7,  5.1, 1.4, 1.6])</span>
<span class="sd">        &gt;&gt;&gt; for ax,alternative in zip(axes,[&quot;less&quot;,&quot;two-sided&quot;,&quot;greater&quot;]):</span>
<span class="sd">        ...     f_test(A, B, alternative=alternative, plot=True, alpha=.1, ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; fig.show()</span>

<span class="sd">    .. seealso::</span>
<span class="sd">        :fa:`wikipedia-w` `F-test &lt;https://en.wikipedia.org/wiki/F-test&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_supported</span><span class="p">(</span><span class="n">lst</span><span class="o">=</span><span class="n">SUPPORTED_ALTERNATIVES</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="n">alternative</span><span class="p">)</span>
    <span class="n">a_unbiased_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1">#: ``a``&#39;s unbiased variable.</span>
    <span class="n">b_unbiased_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1">#: ``b``&#39;s unbiased variable.</span>
    <span class="n">a_degrees_of_freedom</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1">#: ``a``&#39;s Degrees of Freedom.</span>
    <span class="n">b_degrees_of_freedom</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1">#: ``b``&#39;s Degrees of Freedom.</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">a_unbiased_var</span> <span class="o">/</span> <span class="n">b_unbiased_var</span>  <span class="c1">#: F-score.</span>
    <span class="n">f_dist</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">f</span><span class="p">(</span>
        <span class="n">dfn</span><span class="o">=</span><span class="n">a_degrees_of_freedom</span><span class="p">,</span> <span class="n">dfd</span><span class="o">=</span><span class="n">b_degrees_of_freedom</span>
    <span class="p">)</span>  <span class="c1"># F-distribution with given Degrees of Freedoms.</span>

    <span class="c1"># ppf : Percent point function</span>
    <span class="c1"># cdf : Cumulative distribution function</span>
    <span class="c1"># sf  : Survival function (1 - cdf )</span>
    <span class="k">if</span> <span class="n">alternative</span> <span class="o">==</span> <span class="s2">&quot;less&quot;</span><span class="p">:</span>
        <span class="n">x_l</span> <span class="o">=</span> <span class="n">f_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">x_r</span> <span class="o">=</span> <span class="n">f_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">p_val</span> <span class="o">=</span> <span class="n">f_dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">alternative</span> <span class="o">==</span> <span class="s2">&quot;greater&quot;</span><span class="p">:</span>
        <span class="n">x_l</span> <span class="o">=</span> <span class="n">f_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">x_r</span> <span class="o">=</span> <span class="n">f_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="n">p_val</span> <span class="o">=</span> <span class="n">f_dist</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Two-side</span>
        <span class="n">x_l</span> <span class="o">=</span> <span class="n">f_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">x_r</span> <span class="o">=</span> <span class="n">f_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">p_val</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="n">f_dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">f</span><span class="p">),</span> <span class="n">f_dist</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">f</span><span class="p">))</span>

    <span class="n">test_result</span> <span class="o">=</span> <span class="n">TestResult</span><span class="p">(</span>
        <span class="n">statistic</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
        <span class="n">pvalue</span><span class="o">=</span><span class="n">p_val</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
        <span class="n">alternative</span><span class="o">=</span><span class="n">alternative</span><span class="p">,</span>
        <span class="n">accepts</span><span class="o">=</span><span class="p">(</span><span class="n">x_l</span><span class="p">,</span> <span class="n">x_r</span><span class="p">),</span>
        <span class="n">distribution</span><span class="o">=</span><span class="n">f_dist</span><span class="p">,</span>
        <span class="n">distname</span><span class="o">=</span><span class="s2">&quot;F&quot;</span><span class="p">,</span>
        <span class="n">testname</span><span class="o">=</span><span class="s2">&quot;f&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">x_max</span> <span class="o">=</span> <span class="mi">3</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">f_dist</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x_max</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-3</span><span class="p">:</span>
                <span class="k">break</span>
            <span class="n">x_max</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">test_result</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">x_max</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">test_result</span></div>


<div class="viewcode-block" id="student_t_test"><a class="viewcode-back" href="../../teilab.statistics.html#teilab.statistics.student_t_test">[docs]</a><span class="k">def</span> <span class="nf">student_t_test</span><span class="p">(</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">],</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">],</span>
    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">alternative</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;two-sided&quot;</span><span class="p">,</span>
    <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TestResult</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;T-test for Equality of averages of TWO INDEPENDENT samples. (SIMILAR VARIANCES)</span>

<span class="sd">    .. admonition:: Statistic ( :math:`T` )</span>

<span class="sd">        .. container:: toggle, toggle-hidden</span>

<span class="sd">            .. math::</span>
<span class="sd">                T={\frac{\overline{A}-{\overline{B}}}{s_p\cdot {\sqrt {\frac{1}{n_A}+\frac{1}{n_B}}}}}</span>

<span class="sd">            where</span>

<span class="sd">            .. math::</span>
<span class="sd">                s_p=\sqrt{\frac {\left(n_A-1\right)s_A^2+\left(n_B-1\right)s_B^2}{n_A+n_B-2}}</span>

<span class="sd">    Args:</span>
<span class="sd">        a,b (NDArray[Any, Number])    : (Observed) Samples. The arrays must have the same shape.</span>
<span class="sd">        alpha (float)                 : The probability of making the wrong decision when the null hypothesis is true.</span>
<span class="sd">        alternative (str, optional)   : Defines the alternative hypothesis. Please choose from [ ``&quot;two-sided&quot;``, ``&quot;less&quot;``, ``&quot;greater&quot;`` ]. Defaults to ``&quot;two-sided&quot;``.</span>
<span class="sd">        plot (bool, optional)         : Whether to plot F-distribution or not. Defaults to ``False``.</span>
<span class="sd">        ax (Optional[Axes], optional) : An instance of ``Axes``. The distribution is drawn here when ``plot`` is ``True`` . Defaults to ``None``.</span>

<span class="sd">    Returns:</span>
<span class="sd">        TestResult: Structure that holds student&#39;s T-test results.</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: When ``alternative`` is not selected from [ ``&quot;two-sided&quot;``, ``&quot;less&quot;``, ``&quot;greater&quot;`` ].</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>
<span class="sd">        :class: popup-img</span>

<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from teilab.utils import subplots_create</span>
<span class="sd">        &gt;&gt;&gt; from teilab.statistics import student_t_test</span>
<span class="sd">        &gt;&gt;&gt; fig, axes = subplots_create(ncols=3, figsize=(18,4), style=&quot;matplotlib&quot;)</span>
<span class="sd">        &gt;&gt;&gt; A = np.array([6.3, 8.1, 9.4, 10.4, 8.6, 10.5, 10.2, 10.5, 10.0, 8.8])</span>
<span class="sd">        &gt;&gt;&gt; B = np.array([4.8, 2.1, 5.1,  2.0, 4.0,  1.0,  3.4,  2.7,  5.1, 1.4, 1.6])</span>
<span class="sd">        &gt;&gt;&gt; for ax,alternative in zip(axes,[&quot;less&quot;,&quot;two-sided&quot;,&quot;greater&quot;]):</span>
<span class="sd">        ...     student_t_test(A, B, alternative=alternative, plot=True, alpha=.1, ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; fig.show()</span>

<span class="sd">    .. seealso::</span>

<span class="sd">        - :fa:`wikipedia-w` `T-test &lt;https://en.wikipedia.org/wiki/T-test#Independent_two-sample_t-test&gt;`_</span>
<span class="sd">        - `scipy.stats.ttest_ind(A, B, equal_var=True) &lt;https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.ttest_ind.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_supported</span><span class="p">(</span><span class="n">lst</span><span class="o">=</span><span class="n">SUPPORTED_ALTERNATIVES</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="n">alternative</span><span class="p">)</span>
    <span class="n">n_a</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1">#: Sample size of ``a``.</span>
    <span class="n">n_b</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  <span class="c1">#: Sample size of ``b``.</span>
    <span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">n_b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1">#: Degrees of Freedom.</span>
    <span class="n">sum_a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># Sum of ``a``.</span>
    <span class="n">sum_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># Sum of ``b``.</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">sum_a</span> <span class="o">/</span> <span class="n">n_a</span> <span class="o">-</span> <span class="n">sum_b</span> <span class="o">/</span> <span class="n">n_b</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
        <span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">sum_a</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_a</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">square</span><span class="p">(</span><span class="n">sum_b</span><span class="p">)</span> <span class="o">/</span> <span class="n">n_b</span><span class="p">))</span>
        <span class="o">/</span> <span class="n">df</span>
        <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">n_a</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">n_b</span><span class="p">)</span>
    <span class="p">)</span>  <span class="c1">#: T-score.</span>
    <span class="n">t_dist</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>  <span class="c1">#: T-distribution with given Degrees of Freedom.</span>

    <span class="c1"># ppf : Percent point function</span>
    <span class="c1"># cdf : Cumulative distribution function</span>
    <span class="c1"># sf  : Survival function (1 - cdf )</span>
    <span class="k">if</span> <span class="n">alternative</span> <span class="o">==</span> <span class="s2">&quot;less&quot;</span><span class="p">:</span>
        <span class="n">x_l</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">x_r</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">p_val</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">alternative</span> <span class="o">==</span> <span class="s2">&quot;greater&quot;</span><span class="p">:</span>
        <span class="n">x_l</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">x_r</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="n">p_val</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Two-side</span>
        <span class="n">x_l</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">x_r</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">p_val</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

    <span class="n">test_result</span> <span class="o">=</span> <span class="n">TestResult</span><span class="p">(</span>
        <span class="n">statistic</span><span class="o">=</span><span class="n">t</span><span class="p">,</span>
        <span class="n">pvalue</span><span class="o">=</span><span class="n">p_val</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
        <span class="n">alternative</span><span class="o">=</span><span class="n">alternative</span><span class="p">,</span>
        <span class="n">accepts</span><span class="o">=</span><span class="p">(</span><span class="n">x_l</span><span class="p">,</span> <span class="n">x_r</span><span class="p">),</span>
        <span class="n">distribution</span><span class="o">=</span><span class="n">t_dist</span><span class="p">,</span>
        <span class="n">distname</span><span class="o">=</span><span class="s2">&quot;T&quot;</span><span class="p">,</span>
        <span class="n">testname</span><span class="o">=</span><span class="s2">&quot;student&#39;s-t&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">x_edge_abs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">test_result</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">x_edge_abs</span><span class="p">,</span> <span class="n">x_edge_abs</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">test_result</span></div>


<div class="viewcode-block" id="welch_t_test"><a class="viewcode-back" href="../../teilab.statistics.html#teilab.statistics.welch_t_test">[docs]</a><span class="k">def</span> <span class="nf">welch_t_test</span><span class="p">(</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">],</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">],</span>
    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">alternative</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;two-sided&quot;</span><span class="p">,</span>
    <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TestResult</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;T-test for Equality of averages of **TWO INDEPENDENT** samples. (**DIFFERENT VARIANCES**)</span>

<span class="sd">    .. admonition:: Statistic ( :math:`T` )</span>

<span class="sd">        .. container:: toggle, toggle-hidden</span>

<span class="sd">            .. math::</span>
<span class="sd">                T=\frac{\Delta\overline {X}}{s_{\Delta\overline{X}}}=\frac{\overline{X}_1-\overline{X}_2}{\sqrt{{s^2_{\overline{X}_1}}+s^2_{\overline{X}_{2}}}}</span>

<span class="sd">            where</span>

<span class="sd">            .. math::</span>
<span class="sd">                s_{{\overline{X}}_{i}}={s_i\over{\sqrt{N_i}}}</span>

<span class="sd">    Args:</span>
<span class="sd">        a,b (NDArray[Any, Number])    : (Observed) Samples. The arrays must have the same shape.</span>
<span class="sd">        alpha (float)                 : The probability of making the wrong decision when the null hypothesis is true.</span>
<span class="sd">        alternative (str, optional)   : Defines the alternative hypothesis. Please choose from [ ``&quot;two-sided&quot;``, ``&quot;less&quot;``, ``&quot;greater&quot;`` ]. Defaults to ``&quot;two-sided&quot;``.</span>
<span class="sd">        plot (bool, optional)         : Whether to plot F-distribution or not. Defaults to ``False``.</span>
<span class="sd">        ax (Optional[Axes], optional) : An instance of ``Axes``. The distribution is drawn here when ``plot`` is ``True`` . Defaults to ``None``.</span>

<span class="sd">    Returns:</span>
<span class="sd">        TestResult: Structure that holds welch&#39;s T-test results.</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: When ``alternative`` is not selected from [ ``&quot;two-sided&quot;``, ``&quot;less&quot;``, ``&quot;greater&quot;`` ].</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>
<span class="sd">        :class: popup-img</span>

<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from teilab.utils import subplots_create</span>
<span class="sd">        &gt;&gt;&gt; from teilab.statistics import welch_t_test</span>
<span class="sd">        &gt;&gt;&gt; fig, axes = subplots_create(ncols=3, figsize=(18,4), style=&quot;matplotlib&quot;)</span>
<span class="sd">        &gt;&gt;&gt; A = np.array([6.3, 8.1, 9.4, 10.4, 8.6, 10.5, 10.2, 10.5, 10.0, 8.8])</span>
<span class="sd">        &gt;&gt;&gt; B = np.array([4.8, 2.1, 5.1,  2.0, 4.0,  1.0,  3.4,  2.7,  5.1, 1.4, 1.6])</span>
<span class="sd">        &gt;&gt;&gt; for ax,alternative in zip(axes,[&quot;less&quot;,&quot;two-sided&quot;,&quot;greater&quot;]):</span>
<span class="sd">        ...     welch_t_test(A, B, alternative=alternative, plot=True, alpha=.1, ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; fig.show()</span>

<span class="sd">    .. seealso::</span>

<span class="sd">        - :fa:`wikipedia-w` `T-test &lt;https://en.wikipedia.org/wiki/T-test#Independent_two-sample_t-test&gt;`_</span>
<span class="sd">        - :fa:`wikipedia-w` `Welch&#39;s_t-test &lt;https://en.wikipedia.org/wiki/Welch%27s_t-test&gt;`_</span>
<span class="sd">        - `scipy.stats.ttest_ind(A, B, equal_var=False) &lt;https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.ttest_ind.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_supported</span><span class="p">(</span><span class="n">lst</span><span class="o">=</span><span class="n">SUPPORTED_ALTERNATIVES</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="n">alternative</span><span class="p">)</span>
    <span class="n">vna</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># ``a``&#39;s unbiased variable. devided by len(a)</span>
    <span class="n">vnb</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>  <span class="c1"># ``b``&#39;s unbiased variable. devided by len(b)</span>
    <span class="n">df</span> <span class="o">=</span> <span class="p">(</span><span class="n">vna</span> <span class="o">+</span> <span class="n">vnb</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">vna</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">vnb</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>  <span class="c1">#: Degrees of Freedom.</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">b</span><span class="p">))</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">vna</span> <span class="o">+</span> <span class="n">vnb</span><span class="p">)</span>  <span class="c1">#: T-score.</span>
    <span class="n">t_dist</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">df</span><span class="p">)</span>  <span class="c1">#: T-distribution with given Degrees of Freedom.</span>

    <span class="c1"># ppf : Percent point function</span>
    <span class="c1"># cdf : Cumulative distribution function</span>
    <span class="c1"># sf  : Survival function (1 - cdf )</span>
    <span class="k">if</span> <span class="n">alternative</span> <span class="o">==</span> <span class="s2">&quot;less&quot;</span><span class="p">:</span>
        <span class="n">x_l</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">x_r</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">p_val</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">alternative</span> <span class="o">==</span> <span class="s2">&quot;greater&quot;</span><span class="p">:</span>
        <span class="n">x_l</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">x_r</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="n">p_val</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Two-side</span>
        <span class="n">x_l</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">x_r</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">p_val</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

    <span class="n">test_result</span> <span class="o">=</span> <span class="n">TestResult</span><span class="p">(</span>
        <span class="n">statistic</span><span class="o">=</span><span class="n">t</span><span class="p">,</span>
        <span class="n">pvalue</span><span class="o">=</span><span class="n">p_val</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
        <span class="n">alternative</span><span class="o">=</span><span class="n">alternative</span><span class="p">,</span>
        <span class="n">accepts</span><span class="o">=</span><span class="p">(</span><span class="n">x_l</span><span class="p">,</span> <span class="n">x_r</span><span class="p">),</span>
        <span class="n">distribution</span><span class="o">=</span><span class="n">t_dist</span><span class="p">,</span>
        <span class="n">distname</span><span class="o">=</span><span class="s2">&quot;T&quot;</span><span class="p">,</span>
        <span class="n">testname</span><span class="o">=</span><span class="s2">&quot;welch-t&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">x_edge_abs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">test_result</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">x_edge_abs</span><span class="p">,</span> <span class="n">x_edge_abs</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">test_result</span></div>


<div class="viewcode-block" id="paired_t_test"><a class="viewcode-back" href="../../teilab.statistics.html#teilab.statistics.paired_t_test">[docs]</a><span class="k">def</span> <span class="nf">paired_t_test</span><span class="p">(</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">],</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">],</span>
    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">alternative</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;two-sided&quot;</span><span class="p">,</span>
    <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TestResult</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;T-test for Equality of averages of TWO RELATED samples.</span>

<span class="sd">    .. admonition:: Statistic ( :math:`T` )</span>

<span class="sd">        .. container:: toggle, toggle-hidden</span>

<span class="sd">            .. math::</span>
<span class="sd">                T=\frac{\overline{D}}{S_D/\sqrt{N}}</span>

<span class="sd">            where :math:`D` is the sample differences ( :math:`D=A-B` ), :math:`N` is the sample length ( :math:`N=\mathrm{len}(A)=\mathrm{len}(B)`)</span>

<span class="sd">    Args:</span>
<span class="sd">        a,b (NDArray[Any, Number])    : (Observed) Samples. The arrays must have the same shape.</span>
<span class="sd">        alpha (float)                 : The probability of making the wrong decision when the null hypothesis is true.</span>
<span class="sd">        alternative (str, optional)   : Defines the alternative hypothesis. Please choose from [ ``&quot;two-sided&quot;``, ``&quot;less&quot;``, ``&quot;greater&quot;`` ]. Defaults to ``&quot;two-sided&quot;``.</span>
<span class="sd">        plot (bool, optional)         : Whether to plot F-distribution or not. Defaults to ``False``.</span>
<span class="sd">        ax (Optional[Axes], optional) : An instance of ``Axes``. The distribution is drawn here when ``plot`` is ``True`` . Defaults to ``None``.</span>

<span class="sd">    Returns:</span>
<span class="sd">        TestResult: Structure that holds paired T-test results.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: When the arrays ``a`` and ``b`` have the different shapes.</span>
<span class="sd">        KeyError: When ``alternative`` is not selected from [ ``&quot;two-sided&quot;``, ``&quot;less&quot;``, ``&quot;greater&quot;`` ].</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>
<span class="sd">        :class: popup-img</span>

<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from teilab.utils import subplots_create</span>
<span class="sd">        &gt;&gt;&gt; from teilab.statistics import paired_t_test</span>
<span class="sd">        &gt;&gt;&gt; fig, axes = subplots_create(ncols=3, figsize=(18,4), style=&quot;matplotlib&quot;)</span>
<span class="sd">        &gt;&gt;&gt; A = np.array([0.7, -1.6, -0.2, -1.2, -0.1, 3.4, 3.7, 0.8, 0.0, 2.0])</span>
<span class="sd">        &gt;&gt;&gt; B = np.array([1.9,  0.8,  1.1,  0.1, -0.1, 4.4, 5.5, 1.6, 4.6, 3.4])</span>
<span class="sd">        &gt;&gt;&gt; for ax,alternative in zip(axes,[&quot;less&quot;,&quot;two-sided&quot;,&quot;greater&quot;]):</span>
<span class="sd">        ...     paired_t_test(A, B, alternative=alternative, plot=True, alpha=.1, ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; fig.show()</span>

<span class="sd">    .. seealso::</span>

<span class="sd">        - :fa:`wikipedia-w` `T-test &lt;https://en.wikipedia.org/wiki/T-test#Dependent_t-test_for_paired_samples&gt;`_</span>
<span class="sd">        - `scipy.stats.ttest_ind(A, B) &lt;https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.ttest_rel.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_supported</span><span class="p">(</span><span class="n">lst</span><span class="o">=</span><span class="n">SUPPORTED_ALTERNATIVES</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="n">alternative</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1">#: Sample size.</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The arrays (a,b) must have the same shape, but got </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">!=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">a</span> <span class="o">-</span> <span class="n">b</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span><span class="p">)</span>  <span class="c1">#: T-score.</span>
    <span class="n">t_dist</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">t</span><span class="p">(</span><span class="n">df</span><span class="o">=</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1">#: T-distribution with given Degrees of Freedom.</span>

    <span class="c1"># ppf : Percent point function</span>
    <span class="c1"># cdf : Cumulative distribution function</span>
    <span class="c1"># sf  : Survival function (1 - cdf )</span>
    <span class="k">if</span> <span class="n">alternative</span> <span class="o">==</span> <span class="s2">&quot;less&quot;</span><span class="p">:</span>
        <span class="n">x_l</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
        <span class="n">x_r</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">p_val</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">alternative</span> <span class="o">==</span> <span class="s2">&quot;greater&quot;</span><span class="p">:</span>
        <span class="n">x_l</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">x_r</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span>
        <span class="n">p_val</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>  <span class="c1"># Two-side</span>
        <span class="n">x_l</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">x_r</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">p_val</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

    <span class="n">test_result</span> <span class="o">=</span> <span class="n">TestResult</span><span class="p">(</span>
        <span class="n">statistic</span><span class="o">=</span><span class="n">t</span><span class="p">,</span>
        <span class="n">pvalue</span><span class="o">=</span><span class="n">p_val</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
        <span class="n">alternative</span><span class="o">=</span><span class="n">alternative</span><span class="p">,</span>
        <span class="n">accepts</span><span class="o">=</span><span class="p">(</span><span class="n">x_l</span><span class="p">,</span> <span class="n">x_r</span><span class="p">),</span>
        <span class="n">distribution</span><span class="o">=</span><span class="n">t_dist</span><span class="p">,</span>
        <span class="n">distname</span><span class="o">=</span><span class="s2">&quot;T&quot;</span><span class="p">,</span>
        <span class="n">testname</span><span class="o">=</span><span class="s2">&quot;paired-t&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">x_edge_abs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">t_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">test_result</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">x_edge_abs</span><span class="p">,</span> <span class="n">x_edge_abs</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">test_result</span></div>


<div class="viewcode-block" id="mann_whitney_u_test"><a class="viewcode-back" href="../../teilab.statistics.html#teilab.statistics.mann_whitney_u_test">[docs]</a><span class="k">def</span> <span class="nf">mann_whitney_u_test</span><span class="p">(</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">],</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">],</span>
    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">alternative</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;two-sided&quot;</span><span class="p">,</span>
    <span class="n">use_continuity</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TestResult</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;NON-PARAMETRIC-test for Equality of averages of TWO INDEPENDENT samples.</span>

<span class="sd">    Mann–Whitney U test is used as significance</span>


<span class="sd">    .. admonition:: Statistic ( :math:`U` )</span>

<span class="sd">        .. container:: toggle, toggle-hidden</span>

<span class="sd">            Let :math:`A_{1},\ldots, A_{n}` be an i.i.d. sample from :math:`A`, and :math:`B_{1},\ldots ,B_{m}` be an i.i.d. sample from :math:`B`, and both samples independent of each other. The corresponding Mann-Whitney :math:`U` statistic is defined as:</span>

<span class="sd">            .. math::</span>
<span class="sd">                U=\sum_{i=1}^{n_A}\sum_{j=1}^{n_B}S(A_{i},B_{j})</span>

<span class="sd">            with</span>

<span class="sd">            .. math::</span>
<span class="sd">                S(A,B)={\begin{cases}1,&amp;{\text{if }}B&lt;A,\\{\tfrac {1}{2}},&amp;{\text{if }}B=A,\\0,&amp;{\text{if }}B&gt;A.\end{cases}}</span>

<span class="sd">            In direct method, for each observation in sample ``a``, the sum of the number of observations in sample ``b`` for which a smaller value was obtained is the :math:`U_A` .</span>

<span class="sd">            In other method, :math:`U_A` is given by:</span>

<span class="sd">            .. math::</span>
<span class="sd">                U_A=R_A-\frac{n_A(n_A+1)}{2}</span>

<span class="sd">            where :math:`n_A` is the sample size for sample ``a``, and :math:`R_A` is the sum of the ranks in sample ``a`` because :math:`\frac{n_A(n_A+1)}{2}` is the sum of all the ranks of ``a`` within sample ``a``.</span>

<span class="sd">            Knowing that :math:`R_A+R_B=N(N+1)/2` and :math:`N=n_A+n_B`, we find that the sum is</span>

<span class="sd">            .. math::</span>
<span class="sd">                U_A + U_B</span>
<span class="sd">                &amp;= \left(R_A - \frac{n_A(n_A+1)}{2}\right) + \left(R_B - \frac{n_B(n_B+1)}{2}\right) \\</span>
<span class="sd">                &amp;= \underbrace{\left(R_A + R_B\right)}_{(N)(N+1)/2} - \frac{1}{2}\left(n_A(n_A+1) + n_B(n_B+1)\right)\\</span>
<span class="sd">                &amp;= n_An_B.</span>

<span class="sd">            For large ( :math:`&gt;20` ) samples, :math:`U` is approximately normally distributed. In this case, the standardized value</span>

<span class="sd">            .. math::</span>
<span class="sd">                z={\frac {U-m_{U}}{\sigma _{U}}}</span>

<span class="sd">            where :math:`m_U` and :math:`\sigma_U` are the mean and standard deviation of :math:`U`, is approximately a standard normal deviate whose significance can be checked in tables of the normal distribution. :math:`m_U` and :math:`\sigma_U` are given by</span>

<span class="sd">            .. math::</span>
<span class="sd">                m_U={\frac {n_An_B}{2}},\ \text{and} \\</span>
<span class="sd">                \sigma _{U}={\sqrt {\frac{n_An_B(n_A+n_B+1)}{12}}}.</span>

<span class="sd">            The formula for the standard deviation is more complicated in the presence of tied ranks. If there are ties in ranks, :math:`\sigma` should be corrected as follows:</span>

<span class="sd">            .. math::</span>
<span class="sd">                \sigma _{\text{corr}}={\sqrt {\frac{n_An_B}{12}\left((N+1)-\sum_{i=1}^k\frac{t_i^3-t_i}{N(N-1)}\right)}}</span>

<span class="sd">            where :math:`N=n_A+n_B, t_i` is the number of subjects sharing rank :math:`i`, and :math:`k` is the number of (distinct) ranks.</span>

<span class="sd">    .. warning::</span>
<span class="sd">        How to calculate the statistic value is different from `scipy &lt;https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.mannwhitneyu.html&gt;`_.</span>

<span class="sd">    Args:</span>
<span class="sd">        a,b (NDArray[Any, Number])      : (Observed) Samples. The arrays must have the same shape.</span>
<span class="sd">        alpha (float)                   : The probability of making the wrong decision when the null hypothesis is true.</span>
<span class="sd">        alternative (str, optional)     : Defines the alternative hypothesis. Please choose from [ ``&quot;two-sided&quot;``, ``&quot;less&quot;``, ``&quot;greater&quot;`` ]. Defaults to ``&quot;two-sided&quot;``.</span>
<span class="sd">        use_continuity (bool, optional) : Whether a continuity correction ( ``1/2.`` ) should be taken into account. Default is ``True`` .</span>
<span class="sd">        plot (bool, optional)           : Whether to plot F-distribution or not. Defaults to ``False``.</span>
<span class="sd">        ax (Optional[Axes], optional)   : An instance of ``Axes``. The distribution is drawn here when ``plot`` is ``True`` . Defaults to ``None``.</span>

<span class="sd">    Returns:</span>
<span class="sd">        TestResult: Structure that holds Mann-Whitney&#39;s U-tesst results.</span>

<span class="sd">    Raises:</span>
<span class="sd">        KeyError: When ``alternative`` is not selected from [ ``&quot;two-sided&quot;``, ``&quot;less&quot;``, ``&quot;greater&quot;`` ].</span>
<span class="sd">        ValueError: When all numbers are identical in mannwhitneyu.</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>
<span class="sd">        :class: popup-img</span>

<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from teilab.utils import subplots_create</span>
<span class="sd">        &gt;&gt;&gt; from teilab.statistics import mann_whitney_u_test</span>
<span class="sd">        &gt;&gt;&gt; fig, axes = subplots_create(ncols=3, figsize=(18,4), style=&quot;matplotlib&quot;)</span>
<span class="sd">        &gt;&gt;&gt; A = np.array([1.83, 1.50, 1.62, 2.48, 1.68, 1.88, 1.55, 3.06, 1.30, 2.01, 3.11])</span>
<span class="sd">        &gt;&gt;&gt; B = np.array([0.88, 0.65, 0.60, 1.05, 1.06, 1.29, 1.06, 2.14, 1.29])</span>
<span class="sd">        &gt;&gt;&gt; for ax,alternative in zip(axes,[&quot;less&quot;,&quot;two-sided&quot;,&quot;greater&quot;]):</span>
<span class="sd">        ...     mann_whitney_u_test(A, B, alternative=alternative, plot=True, alpha=.1, ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; fig.show()</span>

<span class="sd">    .. seealso::</span>

<span class="sd">        - :fa:`wikipedia-w` `Mann-Whitney_U_test &lt;https://en.wikipedia.org/wiki/Mann-Whitney_U_test&gt;`_</span>
<span class="sd">        - :fa:`home` `On a Test of Whether one of Two Random Variables is Stochastically Larger than the Other &lt;https://www.jstor.org/stable/2236101&gt;`_</span>
<span class="sd">        - `scipy.stats.mannwhitneyu(A, B) &lt;https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.mannwhitneyu.html&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_supported</span><span class="p">(</span><span class="n">lst</span><span class="o">=</span><span class="n">SUPPORTED_ALTERNATIVES</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="n">alternative</span><span class="p">)</span>
    <span class="n">n_a</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="n">n_b</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    <span class="c1"># Assign numeric ranks to all the observations (put the observations from both groups to one set), beginning with 1 for the samllest value.</span>
    <span class="n">ranking</span> <span class="o">=</span> <span class="n">assign_rank</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)))</span>
    <span class="c1"># Calculate Ua (for ``a``) and Ub (for ``b``)</span>
    <span class="n">Ua</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">ranking</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="n">n_a</span><span class="p">])</span> <span class="o">-</span> <span class="p">(</span><span class="n">n_a</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.0</span>
    <span class="n">Ub</span> <span class="o">=</span> <span class="n">n_a</span> <span class="o">*</span> <span class="n">n_b</span> <span class="o">-</span> <span class="n">Ua</span>  <span class="c1">#: ∵) Ua+Ub = n_a*n_b, so remainder is ``Ub``</span>
    <span class="n">T</span> <span class="o">=</span> <span class="n">tiecorrect</span><span class="p">(</span><span class="n">ranking</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">T</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All numbers are identical in mannwhitneyu&quot;</span><span class="p">)</span>
    <span class="n">mean_rank</span> <span class="o">=</span> <span class="n">n_a</span> <span class="o">*</span> <span class="n">n_b</span> <span class="o">/</span> <span class="mf">2.0</span> <span class="o">+</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">use_continuity</span>  <span class="c1">#: mean of ``U``</span>
    <span class="n">sd_rank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">T</span> <span class="o">*</span> <span class="n">n_a</span> <span class="o">*</span> <span class="n">n_b</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_a</span> <span class="o">+</span> <span class="n">n_b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mf">12.0</span><span class="p">)</span>  <span class="c1">#: corrected standard deviation of ``U``</span>
    <span class="n">norm_dist</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">alternative</span> <span class="o">==</span> <span class="s2">&quot;two-sided&quot;</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">Ua</span><span class="p">,</span> <span class="n">Ub</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">mean_rank</span><span class="p">)</span> <span class="o">/</span> <span class="n">sd_rank</span>
        <span class="n">x_l</span> <span class="o">=</span> <span class="n">norm_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">x_r</span> <span class="o">=</span> <span class="n">norm_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">p_val</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">norm_dist</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">Ua</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">u</span> <span class="o">-</span> <span class="n">mean_rank</span><span class="p">)</span> <span class="o">/</span> <span class="n">sd_rank</span>
        <span class="k">if</span> <span class="n">alternative</span> <span class="o">==</span> <span class="s2">&quot;less&quot;</span><span class="p">:</span>
            <span class="n">x_l</span> <span class="o">=</span> <span class="n">norm_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
            <span class="n">x_r</span> <span class="o">=</span> <span class="n">norm_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">p_val</span> <span class="o">=</span> <span class="n">norm_dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>  <span class="c1"># alternative == &quot;greater&quot;:</span>
            <span class="n">x_l</span> <span class="o">=</span> <span class="n">norm_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">x_r</span> <span class="o">=</span> <span class="n">norm_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span>
            <span class="n">p_val</span> <span class="o">=</span> <span class="n">norm_dist</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>

    <span class="n">test_result</span> <span class="o">=</span> <span class="n">TestResult</span><span class="p">(</span>
        <span class="n">statistic</span><span class="o">=</span><span class="n">u</span><span class="p">,</span>
        <span class="n">pvalue</span><span class="o">=</span><span class="n">p_val</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
        <span class="n">alternative</span><span class="o">=</span><span class="n">alternative</span><span class="p">,</span>
        <span class="n">accepts</span><span class="o">=</span><span class="p">(</span><span class="n">x_l</span><span class="p">,</span> <span class="n">x_r</span><span class="p">),</span>
        <span class="n">distribution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">distname</span><span class="o">=</span><span class="s2">&quot;(approx.) Normal Distribution&quot;</span><span class="p">,</span>
        <span class="n">testname</span><span class="o">=</span><span class="s2">&quot;Mann-Whitney&#39;s-u&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">test_result_for_plot</span> <span class="o">=</span> <span class="n">TestResult</span><span class="p">(</span>
            <span class="n">statistic</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
            <span class="n">pvalue</span><span class="o">=</span><span class="n">p_val</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
            <span class="n">alternative</span><span class="o">=</span><span class="n">alternative</span><span class="p">,</span>
            <span class="n">accepts</span><span class="o">=</span><span class="p">(</span><span class="n">x_l</span><span class="p">,</span> <span class="n">x_r</span><span class="p">),</span>
            <span class="n">distribution</span><span class="o">=</span><span class="n">norm_dist</span><span class="p">,</span>
            <span class="n">distname</span><span class="o">=</span><span class="s2">&quot;Normal&quot;</span><span class="p">,</span>
            <span class="n">testname</span><span class="o">=</span><span class="s2">&quot;Mann-Whitney&#39;s-u&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">x_edge_abs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">norm_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">test_result_for_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">x_edge_abs</span><span class="p">,</span> <span class="n">x_edge_abs</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">test_result</span></div>


<div class="viewcode-block" id="wilcoxon_test"><a class="viewcode-back" href="../../teilab.statistics.html#teilab.statistics.wilcoxon_test">[docs]</a><span class="k">def</span> <span class="nf">wilcoxon_test</span><span class="p">(</span>
    <span class="n">a</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">],</span>
    <span class="n">b</span><span class="p">:</span> <span class="n">NDArray</span><span class="p">[</span><span class="n">Any</span><span class="p">,</span> <span class="n">Number</span><span class="p">],</span>
    <span class="n">alpha</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
    <span class="n">alternative</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;two-sided&quot;</span><span class="p">,</span>
    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;auto&quot;</span><span class="p">,</span>
    <span class="n">plot</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Axes</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TestResult</span><span class="p">:</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;NON-PARAMETRIC-test for Equality of representative values (medians) of TWO PAIRED samples.</span>

<span class="sd">    This function is about the Wilcoxon **signed-rank** test which tests whether the distribution of the differences ``a - b`` is symmetric about zero. It is a non-parametric version of the :func:`paired_t_test &lt;teilab.statistics.paired_t_test&gt;`.</span>

<span class="sd">    NOTE:</span>
<span class="sd">        Wilcoxon **signed-rank** test is different from Wilcoxon **rank sum** test which is equivalent to the :func:`student_t_test &lt;teilab.statistics.student_t_test&gt;` or :func:`welch_t_test &lt;teilab.statistics.welch_t_test&gt;` in the parametric test.</span>

<span class="sd">    .. admonition:: Statistic ( :math:`W` )</span>

<span class="sd">        .. container:: toggle, toggle-hidden</span>

<span class="sd">            Let :math:`N` be the sample size, i.e., the number of pairs (:math:`A=a_i,\ldots,a_N, B=b_i,\ldots,b_N`).</span>

<span class="sd">            1. Exclude pairs with :math:`|a_i-b_i|=0`. Let :math:`N_r` be the reduced sample size.</span>
<span class="sd">            2. Order the remaining :math:`N_r` pairs acoording to the absolute difference (:math:`|a_i-b_i|`).</span>
<span class="sd">            3. Rank the pairs. Ties receive a rank equal to the average og the ranks they span (:func:`assign_rank(a-b, method=&quot;average&quot;) &lt;teilab.utils.math_utils.assign_rank&gt;`). Let :math:`R_i` denote the rank.</span>
<span class="sd">            4. Calculate the test statistic :math:`W` (the sum of the signed ranks)</span>

<span class="sd">            .. math::</span>
<span class="sd">                W_{+}&amp;=\sum_{i=1}^{N_r}\left[\operatorname{sgn}(a_i-b_i)\cdot R_{i}\right],\\</span>
<span class="sd">                W_{-}&amp;=\sum_{i=1}^{N_r}\left[-\operatorname{sgn}(a_i-b_i)\cdot R_{i}\right].</span>

<span class="sd">            5. From the above, use :math:`W` that matches the alternative hypothesis.</span>

<span class="sd">            .. math::</span>
<span class="sd">                W=\begin{cases}</span>
<span class="sd">                \mathrm{min}\left(W_{+},W_{-}\right),&amp;\text{if alternative hypothesis is &quot;two-tailed&quot;},\\</span>
<span class="sd">                W_{+},&amp;\text{otherwise.}</span>
<span class="sd">                \end{cases}</span>

<span class="sd">            6. As :math:`N_r` increases, the sampling distribution of :math:`W` converges to a normal distribution. Thus,</span>

<span class="sd">                1. For :math:`N_r\geq25`, a z-score can be calculated as</span>

<span class="sd">                .. math::</span>
<span class="sd">                    Z = \frac{\left|W-\frac{N_r(N_r+1)}{4}\right|}{\sqrt{\frac{N_r(N_r+1)(2N_r+1)}{24}}}</span>

<span class="sd">                2. For :math:`N_r&lt;25` the exact distribution needs to be used.</span>

<span class="sd">    Args:</span>
<span class="sd">        a,b (NDArray[Any, Number])    : (Observed) Samples. The arrays must have the same shape.</span>
<span class="sd">        alpha (float)                 : The probability of making the wrong decision when the null hypothesis is true.</span>
<span class="sd">        alternative (str, optional)   : Defines the alternative hypothesis. Please choose from [ ``&quot;two-sided&quot;``, ``&quot;less&quot;``, ``&quot;greater&quot;`` ]. Defaults to ``&quot;two-sided&quot;``.</span>
<span class="sd">        mode (str, optional)          : Method to calculate the p-value. Please choose from [ ``&quot;auto&quot;``, ``&quot;exact&quot;``, ``&quot;approx&quot;`` ]. Default is &quot;auto&quot;.</span>
<span class="sd">        plot (bool, optional)         : Whether to plot F-distribution or not. Defaults to ``False``.</span>
<span class="sd">        ax (Optional[Axes], optional) : An instance of ``Axes``. The distribution is drawn here when ``plot`` is ``True`` . Defaults to ``None``.</span>

<span class="sd">    Returns:</span>
<span class="sd">        TestResult: Structure that holds wilcoxon-test results.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: When the arrays ``a`` and ``b`` have the different shapes.</span>
<span class="sd">        KeyError: When ``alternative`` is not selected from [ ``&quot;two-sided&quot;``, ``&quot;less&quot;``, ``&quot;greater&quot;`` ].</span>
<span class="sd">        ValueError: When all pairs are identical, or try to calculate ``&quot;exact&quot;`` p-value with the sample size larger than ``25``.</span>

<span class="sd">    .. plot::</span>
<span class="sd">        :include-source:</span>
<span class="sd">        :class: popup-img</span>

<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from teilab.utils import subplots_create</span>
<span class="sd">        &gt;&gt;&gt; from teilab.statistics import wilcoxon_test</span>
<span class="sd">        &gt;&gt;&gt; fig, axes = subplots_create(ncols=3, figsize=(18,4), style=&quot;matplotlib&quot;)</span>
<span class="sd">        &gt;&gt;&gt; rnd = np.random.RandomState(0)</span>
<span class="sd">        &gt;&gt;&gt; A,B = rnd.random_sample(size=(2,30))</span>
<span class="sd">        &gt;&gt;&gt; for ax,alternative in zip(axes,[&quot;less&quot;,&quot;two-sided&quot;,&quot;greater&quot;]):</span>
<span class="sd">        ...     wilcoxon_test(A, B, alternative=alternative, plot=True, alpha=.1, ax=ax)</span>
<span class="sd">        &gt;&gt;&gt; fig.show()</span>

<span class="sd">    .. seealso::</span>

<span class="sd">        - https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.kruskal.html#scipy.stats.kruskal</span>
<span class="sd">        - https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.mannwhitneyu.html#scipy.stats.mannwhitneyu</span>
<span class="sd">        - `scipy.stats.wilcoxon(A, B, correction=False, alternative=&quot;two-sided&quot;) &lt;https://docs.scipy.org/doc/scipy/reference/generated/scipy.stats.wilcoxon.html&gt;`_</span>
<span class="sd">        - :fa:`wikipedia-w` `Wilcoxon_signed-rank_test &lt;https://en.wikipedia.org/wiki/Wilcoxon_signed-rank_test&gt;`_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">check_supported</span><span class="p">(</span><span class="n">lst</span><span class="o">=</span><span class="n">SUPPORTED_ALTERNATIVES</span><span class="p">,</span> <span class="n">alternative</span><span class="o">=</span><span class="n">alternative</span><span class="p">)</span>
    <span class="n">check_supported</span><span class="p">(</span><span class="n">lst</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;auto&quot;</span><span class="p">,</span> <span class="s2">&quot;exact&quot;</span><span class="p">,</span> <span class="s2">&quot;approx&quot;</span><span class="p">],</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The arrays (a,b) must have the same shape, but got </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">!=</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">b</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Determine how to calculate the p-value from the difference and the samle size.</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">a</span> <span class="o">-</span> <span class="n">b</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;auto&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;=</span> <span class="mi">25</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;exact&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;approx&quot;</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">diff</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;exact&quot;</span><span class="p">:</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="s2">&quot;approx&quot;</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="n">_pack_warning_args</span><span class="p">(</span>
                <span class="s2">&quot;Exact p-value calculation does not work if there are ties. Switching to normal approximation.&quot;</span><span class="p">,</span>
                <span class="vm">__file__</span><span class="p">,</span>
                <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span><span class="p">,</span>
            <span class="p">),</span>
            <span class="n">category</span><span class="o">=</span><span class="n">InsufficientUnderstandingWarning</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="c1"># Leave only pairs with differences.</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">diff</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">diff</span><span class="p">)[</span><span class="mi">0</span><span class="p">]]</span>
    <span class="n">count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;All pairs are identical.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">count</span> <span class="o">&lt;</span> <span class="mi">10</span> <span class="ow">and</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;approx&quot;</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
            <span class="n">_pack_warning_args</span><span class="p">(</span>
                <span class="s2">&quot;Sample size too samll for normal approximation&quot;</span><span class="p">,</span> <span class="vm">__file__</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">()</span><span class="o">.</span><span class="n">f_code</span><span class="o">.</span><span class="n">co_name</span>
            <span class="p">),</span>
            <span class="n">category</span><span class="o">=</span><span class="n">InsufficientUnderstandingWarning</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="c1"># Assign Ranking and calculate T-score.</span>
    <span class="n">ranking</span> <span class="o">=</span> <span class="n">assign_rank</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">diff</span><span class="p">))</span>
    <span class="n">w_plus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">ranking</span><span class="p">)</span>
    <span class="n">w_minus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">diff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">ranking</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">alternative</span> <span class="o">==</span> <span class="s2">&quot;two-sided&quot;</span><span class="p">:</span>
        <span class="n">W</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">w_plus</span><span class="p">,</span> <span class="n">w_minus</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">w_plus</span>
    <span class="c1"># Calculate p-value.</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s2">&quot;approx&quot;</span><span class="p">:</span>
        <span class="n">norm_dist</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="p">(</span><span class="n">W</span> <span class="o">-</span> <span class="n">count</span> <span class="o">*</span> <span class="p">(</span><span class="n">count</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.25</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">count</span> <span class="o">*</span> <span class="p">(</span><span class="n">count</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="n">count</span> <span class="o">+</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">24</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">alternative</span> <span class="o">==</span> <span class="s2">&quot;two-sided&quot;</span><span class="p">:</span>
            <span class="n">x_l</span> <span class="o">=</span> <span class="n">norm_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">x_r</span> <span class="o">=</span> <span class="n">norm_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">p_val</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">norm_dist</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">alternative</span> <span class="o">==</span> <span class="s2">&quot;less&quot;</span><span class="p">:</span>
            <span class="n">x_l</span> <span class="o">=</span> <span class="n">norm_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">alpha</span><span class="p">)</span>
            <span class="n">x_r</span> <span class="o">=</span> <span class="n">norm_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">p_val</span> <span class="o">=</span> <span class="n">norm_dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_l</span> <span class="o">=</span> <span class="n">norm_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">x_r</span> <span class="o">=</span> <span class="n">norm_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span>
            <span class="n">p_val</span> <span class="o">=</span> <span class="n">norm_dist</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
            <span class="n">test_result_for_plot</span> <span class="o">=</span> <span class="n">TestResult</span><span class="p">(</span>
                <span class="n">statistic</span><span class="o">=</span><span class="n">z</span><span class="p">,</span>
                <span class="n">pvalue</span><span class="o">=</span><span class="n">p_val</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                <span class="n">alternative</span><span class="o">=</span><span class="n">alternative</span><span class="p">,</span>
                <span class="n">accepts</span><span class="o">=</span><span class="p">(</span><span class="n">x_l</span><span class="p">,</span> <span class="n">x_r</span><span class="p">),</span>
                <span class="n">distribution</span><span class="o">=</span><span class="n">norm_dist</span><span class="p">,</span>
                <span class="n">distname</span><span class="o">=</span><span class="s2">&quot;(approx.) Normal&quot;</span><span class="p">,</span>
                <span class="n">testname</span><span class="o">=</span><span class="s2">&quot;Wilcoxon signed-rank&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">x_edge_abs</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">norm_dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mf">1e-4</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">test_result_for_plot</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="n">x_edge_abs</span><span class="p">,</span> <span class="n">x_edge_abs</span><span class="p">,</span> <span class="mi">1000</span><span class="p">),</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="n">_wilcoxon_data</span><span class="o">.</span><span class="n">COUNTS</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">cnt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The exact distribution of the Wilcoxon test static is not implemented for n=</span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">cnt</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="c1"># note: w_plus is int (ties not allowed), need int for slices below</span>
        <span class="n">w_plus</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">w_plus</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">alternative</span> <span class="o">==</span> <span class="s2">&quot;two-sided&quot;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">w_plus</span> <span class="o">==</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">:</span>
                <span class="c1"># w_plus is the center of the distribution.</span>
                <span class="n">prob</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">p_less</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cnt</span><span class="p">[:</span> <span class="n">w_plus</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">count</span>
                <span class="n">p_greater</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">w_plus</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">count</span>
                <span class="n">p_val</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="nb">min</span><span class="p">(</span><span class="n">p_greater</span><span class="p">,</span> <span class="n">p_less</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">alternative</span> <span class="o">==</span> <span class="s2">&quot;greater&quot;</span><span class="p">:</span>
            <span class="n">p_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cnt</span><span class="p">[</span><span class="n">w_plus</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">count</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">p_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">cnt</span><span class="p">[:</span> <span class="n">w_plus</span> <span class="o">+</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">count</span>
        <span class="c1"># if plot:</span>
        <span class="c1">#     warnings.warn()</span>
    <span class="n">test_result</span> <span class="o">=</span> <span class="n">TestResult</span><span class="p">(</span>
        <span class="n">statistic</span><span class="o">=</span><span class="n">W</span><span class="p">,</span>
        <span class="n">pvalue</span><span class="o">=</span><span class="n">p_val</span><span class="p">,</span>
        <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
        <span class="n">alternative</span><span class="o">=</span><span class="n">alternative</span><span class="p">,</span>
        <span class="n">accepts</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
        <span class="n">distribution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
        <span class="n">distname</span><span class="o">=</span><span class="s2">&quot;(approx.) Normal&quot;</span><span class="p">,</span>
        <span class="n">testname</span><span class="o">=</span><span class="s2">&quot;Wilcoxon signed-rank&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">test_result</span></div>


<div class="viewcode-block" id="anova"><a class="viewcode-back" href="../../teilab.statistics.html#teilab.statistics.anova">[docs]</a><span class="k">def</span> <span class="nf">anova</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">TestResult</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;I&#39;m sorry... Not Impremented.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="friedman_test"><a class="viewcode-back" href="../../teilab.statistics.html#teilab.statistics.friedman_test">[docs]</a><span class="k">def</span> <span class="nf">friedman_test</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">TestResult</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;I&#39;m sorry... Not Impremented.&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="kruskal_wallis_test"><a class="viewcode-back" href="../../teilab.statistics.html#teilab.statistics.kruskal_wallis_test">[docs]</a><span class="k">def</span> <span class="nf">kruskal_wallis_test</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">TestResult</span><span class="p">:</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;I&#39;m sorry... Not Impremented.&quot;</span><span class="p">)</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, iwasakishuto.

    </p>
  </div> 

</footer>
        </div> 
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    
<style id="style-expand" disabled="true">
  .wy-nav-content {
    max-width: 100% !important;
  }
</style>
<script>
  document.getElementById("style-expand").disabled = true;
</script>


</body>
</html>